<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Purposive Communication | Admin Dashboard</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              50: "#E7F7F5",
              100: "#CFF0EC",
              200: "#9FE1D9",
              300: "#6ED2C6",
              400: "#3EC3B3",
              500: "#13A89A",
              600: "#0F877B",
              700: "#0B665C",
              800: "#07453E",
              900: "#032420",
            },
          },
          boxShadow: {
            soft: "0 18px 45px rgba(2, 8, 23, 0.10)",
            softer: "0 12px 30px rgba(2, 8, 23, 0.08)",
          },
        },
      },
    };
  </script>

  <style>
    .page-bg{
      background:
        radial-gradient(1200px 500px at 10% -10%, rgba(19,168,154,0.16), transparent 55%),
        radial-gradient(900px 450px at 100% 0%, rgba(19,168,154,0.12), transparent 50%),
        #E7F7F5;
    }
    .nice-scroll::-webkit-scrollbar{ width: 10px; }
    .nice-scroll::-webkit-scrollbar-thumb{ background: rgba(2,8,23,.15); border-radius: 999px; }
    .nice-scroll::-webkit-scrollbar-track{ background: transparent; }

    :root{ --ease-out: cubic-bezier(.22,1,.36,1); }

    @media (prefers-reduced-motion: reduce){
      *, *::before, *::after{ animation: none !important; transition: none !important; scroll-behavior: auto !important; }
    }

    body.page-bg{
      position: relative;
      overflow-x: hidden;
    }
    body.page-bg::before,
    body.page-bg::after{
      content:"";
      position: fixed;
      inset: -240px;
      pointer-events: none;
      z-index: -1;
      filter: blur(50px);
      opacity: .45;
      transform: translate3d(0,0,0);
    }
    body.page-bg::before{
      background:
        radial-gradient(closest-side at 20% 30%, rgba(19,168,154,.26), transparent 65%),
        radial-gradient(closest-side at 80% 20%, rgba(59,130,246,.16), transparent 60%),
        radial-gradient(closest-side at 55% 85%, rgba(16,185,129,.14), transparent 62%);
      animation: blobDriftA 14s var(--ease-out) infinite alternate;
    }
    body.page-bg::after{
      background:
        radial-gradient(closest-side at 15% 80%, rgba(244,63,94,.10), transparent 62%),
        radial-gradient(closest-side at 90% 70%, rgba(19,168,154,.18), transparent 62%),
        radial-gradient(closest-side at 55% 10%, rgba(14,165,233,.12), transparent 64%);
      opacity: .35;
      animation: blobDriftB 18s var(--ease-out) infinite alternate;
    }
    @keyframes blobDriftA{
      0%{ transform: translate(-14px,-10px) scale(1); }
      50%{ transform: translate(16px, 8px) scale(1.04); }
      100%{ transform: translate(10px,16px) scale(1.02); }
    }
    @keyframes blobDriftB{
      0%{ transform: translate(12px,14px) scale(1); }
      50%{ transform: translate(-10px, 4px) scale(1.05); }
      100%{ transform: translate(-16px,-12px) scale(1.02); }
    }

    .panel-anim{ animation: fadeSlideIn .35s var(--ease-out) both; }
    @keyframes fadeSlideIn{
      from{ opacity: 0; transform: translateY(10px); }
      to{ opacity: 1; transform: translateY(0); }
    }

    @keyframes cardPop{
      from{ opacity:0; transform: translateY(12px) scale(.985); }
      to{ opacity:1; transform: translateY(0) scale(1); }
    }
    .stagger > *{
      opacity:0;
      transform: translateY(12px);
      animation: cardPop .40s var(--ease-out) both;
    }

    aside{ animation: asideIn .40s var(--ease-out) both; }
    @keyframes asideIn{
      from{ opacity: 0; transform: translateX(-10px); }
      to{ opacity: 1; transform: translateX(0); }
    }

    .tab-btn{
      color: rgb(30 41 59);
      transition: transform .18s var(--ease-out), background-color .18s var(--ease-out), box-shadow .18s var(--ease-out);
    }
    .tab-btn:hover{ background: rgba(2,8,23,0.04); transform: translateY(-1px); }
    .tab-btn:active{ transform: translateY(0); }

    .stat-card{
      position: relative;
      overflow: hidden;
      transition: transform .22s var(--ease-out), box-shadow .22s var(--ease-out);
    }
    .stat-card::after{
      content:"";
      position:absolute;
      inset:-2px;
      background: linear-gradient(120deg, transparent 0%, rgba(255,255,255,.55) 45%, transparent 70%);
      transform: translateX(-120%);
      opacity: .0;
      transition: transform .75s var(--ease-out), opacity .35s var(--ease-out);
      pointer-events:none;
    }
    .stat-card:hover{
      transform: translateY(-2px);
      box-shadow: 0 18px 45px rgba(2, 8, 23, 0.12);
    }
    .stat-card:hover::after{
      transform: translateX(120%);
      opacity: .9;
    }

    .teacher-tap{
      position: relative;
      overflow: hidden;
      transition: transform .22s var(--ease-out), box-shadow .22s var(--ease-out), background-color .22s var(--ease-out);
      will-change: transform;
    }
    .teacher-tap::after{
      content:"";
      position:absolute;
      inset:-2px;
      background: linear-gradient(120deg, transparent 0%, rgba(19,168,154,.10) 45%, transparent 70%);
      transform: translateX(-110%);
      opacity: .0;
      transition: transform .85s var(--ease-out), opacity .25s var(--ease-out);
      pointer-events:none;
    }
    .teacher-tap:hover{ box-shadow: 0 18px 45px rgba(2, 8, 23, 0.12); }
    .teacher-tap:hover::after{ transform: translateX(120%); opacity: .95; }

    .teacher-selected{
      background: rgba(19,168,154,0.10) !important;
      box-shadow: 0 18px 45px rgba(2, 8, 23, 0.12);
      border-color: rgba(19,168,154,0.35) !important;
    }

    #toast{ transform-origin: top center; }
    #toast:not(.hidden){ animation: toastIn .22s var(--ease-out) both; }
    @keyframes toastIn{
      from{ opacity: 0; transform: translateY(-8px) scale(.98); }
      to{ opacity: 1; transform: translateY(0) scale(1); }
    }

    #sidebarOverlay:not(.hidden) #sidebarBackdrop{ animation: fadeIn .20s var(--ease-out) both; }
    #sidebarOverlay:not(.hidden) > div:last-child{ animation: slideInLeft .28s var(--ease-out) both; }
    @keyframes fadeIn{ from{ opacity:0; } to{ opacity:1; } }
    @keyframes slideInLeft{ from{ opacity:0; transform: translateX(-10px); } to{ opacity:1; transform: translateX(0); } }

    .sheet-hidden{ opacity:0; pointer-events:none; }
    .sheet-backdrop{ opacity:0; transition: opacity .25s var(--ease-out); }
    .sheet-panel{
      transform: translateY(20px);
      opacity: 0;
      transition: transform .38s var(--ease-out), opacity .38s var(--ease-out);
    }
    .sheet-open .sheet-backdrop{ opacity:1; }
    .sheet-open .sheet-panel{ transform: translateY(0); opacity:1; }

    @keyframes badgePop{
      from{ opacity:.4; transform: scale(.86); }
      to{ opacity:1; transform: scale(1); }
    }
    #badgePending:not(.hidden),
    #mBadgePending:not(.hidden){
      animation: badgePop .22s var(--ease-out) both;
    }

    [data-approve], [data-reject]{
      position: relative;
      overflow: hidden;
      transform: translateZ(0);
    }
    [data-approve]::after, [data-reject]::after{
      content:"";
      position:absolute;
      inset:-2px;
      background: linear-gradient(120deg, transparent 0%, rgba(255,255,255,.35) 45%, transparent 70%);
      transform: translateX(-120%);
      transition: transform .75s var(--ease-out);
      pointer-events:none;
      opacity:.0;
    }
    [data-approve]:hover::after, [data-reject]:hover::after{
      transform: translateX(120%);
      opacity:.9;
    }

    /* Change visible label inside teacher cards */
    .teacher-tap .mt-3.grid p:first-child > span.text-slate-500{
      color: transparent;
      position: relative;
      display: inline-block;
    }
    .teacher-tap .mt-3.grid p:first-child > span.text-slate-500::after{
      content: "Employee ID:";
      color: rgb(100 116 139);
      position: absolute;
      left: 0;
      top: 0;
      white-space: nowrap;
    }
  </style>
</head>

<body class="page-bg text-slate-800">
  <div class="min-h-screen flex">
    <!-- SIDEBAR -->
    <aside class="hidden lg:flex w-72 shrink-0 flex-col bg-white/80 backdrop-blur border-r border-slate-100">
      <div class="px-6 py-5 flex items-center gap-3 border-b border-slate-100">
        <div class="h-11 w-11 rounded-xl bg-brand-500/10 ring-1 ring-black/5 flex items-center justify-center">
          <svg viewBox="0 0 24 24" class="h-6 w-6 text-brand-700" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6V4m0 2a4 4 0 00-4 4v2a4 4 0 008 0v-2a4 4 0 00-4-4z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 20h12" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M8 20v-3m8 3v-3" />
          </svg>
        </div>
        <div>
          <p class="text-base font-extrabold text-slate-900 leading-tight">Purposive Communication</p>
          <p class="text-xs text-slate-500 font-semibold">Admin Dashboard</p>
        </div>
      </div>

      <nav class="px-4 py-4 flex-1" role="tablist" aria-label="Admin sections">
        <button type="button" data-tab="approvals" role="tab" aria-controls="panel-approvals" aria-selected="true"
          class="tab-btn w-full text-left flex items-center gap-3 rounded-xl px-4 py-3 text-sm font-semibold">
          <span class="h-9 w-9 rounded-xl flex items-center justify-center">
            <svg viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" />
            </svg>
          </span>
          Teacher Approvals
          <span id="badgePending" class="ml-auto hidden rounded-full bg-amber-100 px-2 py-0.5 text-[11px] font-extrabold text-amber-800 ring-1 ring-black/5">0</span>
        </button>

        <button type="button" data-tab="teachers" role="tab" aria-controls="panel-teachers" aria-selected="false"
          class="tab-btn mt-2 w-full text-left flex items-center gap-3 rounded-xl px-4 py-3 text-sm font-semibold">
          <span class="h-9 w-9 rounded-xl flex items-center justify-center">
            <svg viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2" />
              <circle cx="12" cy="7" r="4" />
            </svg>
          </span>
          Teachers
        </button>
      </nav>

      <div class="mt-auto px-4 py-5 border-t border-slate-100">
        <a href="#" id="logoutLink" class="flex items-center gap-3 rounded-xl px-4 py-3 text-sm font-semibold text-rose-600 hover:bg-rose-50 transition">
          <span class="h-9 w-9 rounded-xl bg-rose-50 ring-1 ring-black/5 flex items-center justify-center">
            <svg viewBox="0 0 24 24" class="h-5 w-5" fill="none" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M10 17l5-5-5-5" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M15 12H3" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M21 21V3" />
            </svg>
          </span>
          Logout
        </a>
      </div>
    </aside>

    <!-- MAIN -->
    <div class="flex-1 flex flex-col min-w-0">
      <!-- TOP BAR -->
      <header class="sticky top-0 z-40 bg-white/80 backdrop-blur border-b border-slate-100">
        <div class="px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between gap-3">
          <div class="flex items-center gap-3 min-w-0">
            <button id="openSidebarBtn"
              class="lg:hidden inline-flex h-11 w-11 items-center justify-center rounded-xl bg-slate-50 ring-1 ring-black/5 hover:bg-slate-100 active:scale-[.98] transition"
              aria-label="Open menu" aria-controls="sidebarOverlay" aria-expanded="false">
              <svg class="h-6 w-6 text-slate-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
              </svg>
            </button>

            <div class="flex items-center gap-3 min-w-0">
              <div class="hidden sm:flex h-11 w-11 items-center justify-center rounded-xl bg-brand-50 ring-1 ring-black/5">
                <svg viewBox="0 0 24 24" class="h-6 w-6 text-brand-700" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4" />
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" />
                </svg>
              </div>
              <div class="min-w-0">
                <p class="text-lg font-extrabold text-slate-900 leading-tight truncate">Admin Dashboard</p>
                <p class="text-xs text-slate-500 font-semibold -mt-0.5 truncate">Teacher approvals & management</p>
              </div>
            </div>
          </div>

          <div class="flex items-center gap-4">
            <div class="flex items-center gap-3">
              <div class="h-11 w-11 rounded-full bg-brand-600 text-white font-extrabold flex items-center justify-center">
                <span id="adminAvatar">AD</span>
              </div>
              <div class="hidden sm:block">
                <p class="text-sm font-extrabold text-slate-900 leading-tight"><span id="adminName">Admin</span></p>
                <p class="text-xs text-slate-500 font-semibold -mt-0.5">Admin</p>
              </div>
            </div>
          </div>
        </div>
      </header>

      <!-- TOAST -->
      <div class="pointer-events-none fixed left-1/2 top-6 z-[9999] -translate-x-1/2">
        <div id="toast" class="pointer-events-auto hidden rounded-2xl bg-white px-4 py-3 shadow-soft ring-1 ring-black/10">
          <p id="toastText" class="text-sm font-extrabold text-slate-900">Done</p>
          <p id="toastSub" class="text-xs font-semibold text-slate-600 mt-0.5">Updated.</p>
        </div>
      </div>

      <!-- CONTENT -->
      <main class="px-4 sm:px-6 lg:px-8 py-8 min-w-0 nice-scroll">

        <!-- APPROVALS -->
        <section id="panel-approvals" role="tabpanel" aria-label="Teacher approvals">
          <div class="grid gap-5 sm:grid-cols-2 lg:grid-cols-4">
            <div class="stat-card rounded-2xl bg-white shadow-softer ring-1 ring-black/5 p-5 relative overflow-hidden">
              <span class="absolute inset-y-0 left-0 w-1.5 bg-amber-500"></span>
              <p class="text-sm font-semibold text-slate-500">Pending Teachers</p>
              <p id="statPending" class="mt-2 text-3xl font-extrabold text-slate-900">0</p>
            </div>

            <div class="stat-card rounded-2xl bg-white shadow-softer ring-1 ring-black/5 p-5 relative overflow-hidden">
              <span class="absolute inset-y-0 left-0 w-1.5 bg-emerald-500"></span>
              <p class="text-sm font-semibold text-slate-500">Approved Teachers</p>
              <p id="statApproved" class="mt-2 text-3xl font-extrabold text-slate-900">0</p>
            </div>

            <div class="stat-card rounded-2xl bg-white shadow-softer ring-1 ring-black/5 p-5 relative overflow-hidden">
              <span class="absolute inset-y-0 left-0 w-1.5 bg-sky-500"></span>
              <p class="text-sm font-semibold text-slate-500">Total Teachers</p>
              <p id="statTotalTeachers" class="mt-2 text-3xl font-extrabold text-slate-900">0</p>
            </div>

            <div class="stat-card rounded-2xl bg-white shadow-softer ring-1 ring-black/5 p-5 relative overflow-hidden">
              <span class="absolute inset-y-0 left-0 w-1.5 bg-brand-500"></span>
              <p class="text-sm font-semibold text-slate-500">Last Sync</p>
              <p id="statSync" class="mt-2 text-lg font-extrabold text-slate-900">—</p>
            </div>
          </div>

          <div class="mt-6 rounded-2xl bg-white shadow-softer ring-1 ring-black/5 p-6">
            <div class="flex flex-col sm:flex-row sm:items-center gap-3 justify-between">
              <div>
                <h2 class="text-xl font-extrabold text-slate-900">Pending Teacher Approvals</h2>
                <p class="mt-1 text-sm text-slate-600">Approve teacher accounts so their dashboard unlocks.</p>
              </div>

              <div class="flex items-center gap-2">
                <div class="relative">
                  <input id="searchPending" type="text" placeholder="Search name or email…"
                    class="w-full sm:w-72 rounded-xl border border-slate-200 bg-white px-4 py-2.5 text-sm font-semibold text-slate-800 shadow-sm outline-none focus:ring-4 focus:ring-brand-200" />
                  <svg class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-4.35-4.35" />
                    <circle cx="10" cy="10" r="6" />
                  </svg>
                </div>
                <button id="refreshBtn"
                  class="inline-flex items-center justify-center rounded-xl bg-slate-100 px-4 py-2.5 text-sm font-extrabold text-slate-800 hover:bg-slate-200 active:scale-[.98] transition">
                  Refresh
                </button>
              </div>
            </div>

            <div id="pendingEmpty" class="hidden mt-6 rounded-2xl bg-slate-50 ring-1 ring-black/5 p-6 text-center">
              <p class="text-sm font-extrabold text-slate-900">No pending teachers</p>
              <p class="mt-1 text-sm text-slate-600">You're all caught up.</p>
            </div>

            <div id="pendingList" class="mt-6 grid gap-4"></div>
          </div>
        </section>

        <!-- TEACHERS -->
        <section id="panel-teachers" class="hidden" role="tabpanel" aria-label="Teachers">
          <div class="rounded-2xl bg-white shadow-softer ring-1 ring-black/5 p-6">
            <div class="flex flex-col sm:flex-row sm:items-center gap-3 justify-between">
              <div>
                <h2 class="text-xl font-extrabold text-slate-900">Teachers</h2>
                <p class="mt-1 text-sm text-slate-600">Tap a teacher to view full info.</p>
              </div>
              <div class="relative">
                <input id="searchTeachers" type="text" placeholder="Search…"
                  class="w-full sm:w-72 rounded-xl border border-slate-200 bg-white px-4 py-2.5 text-sm font-semibold text-slate-800 shadow-sm outline-none focus:ring-4 focus:ring-brand-200" />
                <svg class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-4.35-4.35" />
                  <circle cx="10" cy="10" r="6" />
                </svg>
              </div>
            </div>

            <div class="mt-6 grid gap-4 lg:grid-cols-3">
              <div class="lg:col-span-2">
                <div id="teachersList" class="grid gap-3"></div>
              </div>

              <aside class="hidden lg:block lg:col-span-1">
                <div class="rounded-2xl bg-slate-50 ring-1 ring-black/5 p-5 sticky top-24">
                  <div class="flex items-center justify-between gap-2">
                    <p class="text-sm font-extrabold text-slate-900">Teacher Details</p>
                    <span id="detailPill" class="hidden rounded-full bg-slate-200 px-2 py-0.5 text-[11px] font-extrabold text-slate-700 ring-1 ring-black/5">—</span>
                  </div>

                  <div id="detailEmpty" class="mt-4 rounded-2xl bg-white ring-1 ring-black/5 p-4">
                    <p class="text-sm font-extrabold text-slate-900">No teacher selected</p>
                    <p class="mt-1 text-sm text-slate-600">Click a teacher card to view details here.</p>
                  </div>

                  <div id="detailBody" class="hidden mt-4 rounded-2xl bg-white ring-1 ring-black/5 p-4">
                    <p id="detailName" class="text-base font-extrabold text-slate-900">—</p>
                    <p id="detailEmail" class="mt-1 text-sm text-slate-700 break-all">—</p>

                    <div class="mt-4 grid gap-2 text-sm font-semibold text-slate-700">
                      <p><span class="text-slate-500">Employee ID:</span> <span id="detailTeacherId">—</span></p>
                      <p><span class="text-slate-500">Department:</span> <span id="detailDept">—</span></p>
                      <p><span class="text-slate-500">Applied:</span> <span id="detailApplied">—</span></p>
                    </div>

                    <!-- ✅ ADMIN DELETE (always allowed for teachers) -->
                    <button id="deleteTeacherBtn"
                      class="hidden mt-4 w-full inline-flex items-center justify-center rounded-xl bg-rose-600 px-4 py-2.5 text-sm font-extrabold text-white shadow-softer hover:bg-rose-700 focus:outline-none focus:ring-4 focus:ring-rose-200 active:scale-[.98] transition">
                      Delete Teacher
                    </button>
                    <p id="deleteHint" class="hidden mt-2 text-xs font-semibold text-slate-500">
                      This deletes the teacher document from Firestore.
                    </p>
                  </div>

                  <span id="detailUid" class="hidden"></span>
                </div>
              </aside>
            </div>

          </div>
        </section>

      </main>
    </div>
  </div>

  <!-- MOBILE SIDEBAR OVERLAY -->
  <div id="sidebarOverlay" class="lg:hidden fixed inset-0 z-50 hidden">
    <div id="sidebarBackdrop" class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm"></div>
    <div class="absolute left-0 top-0 bottom-0 w-80 max-w-[88vw] bg-white shadow-soft ring-1 ring-black/10">
      <div class="px-6 py-5 flex items-center justify-between border-b border-slate-100">
        <div>
          <p class="text-base font-extrabold text-slate-900 leading-tight">Admin Dashboard</p>
          <p class="text-xs text-slate-500 font-semibold">Menu</p>
        </div>
        <button id="closeSidebarBtn" class="h-11 w-11 rounded-xl bg-slate-50 ring-1 ring-black/5 hover:bg-slate-100 inline-flex items-center justify-center active:scale-[.98] transition" aria-label="Close menu">
          <svg class="h-6 w-6 text-slate-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>

      <div class="p-4">
        <button type="button" data-tab="approvals" class="m-tab w-full text-left rounded-xl px-4 py-3 text-sm font-extrabold hover:bg-slate-50 transition">
          Teacher Approvals <span id="mBadgePending" class="ml-2 hidden rounded-full bg-amber-100 px-2 py-0.5 text-[11px] font-extrabold text-amber-800 ring-1 ring-black/5">0</span>
        </button>
        <button type="button" data-tab="teachers" class="m-tab mt-2 w-full text-left rounded-xl px-4 py-3 text-sm font-extrabold hover:bg-slate-50 transition">
          Teachers
        </button>

        <a href="#" id="mLogoutLink" class="mt-4 block w-full text-left rounded-xl px-4 py-3 text-sm font-extrabold text-rose-600 hover:bg-rose-50 transition">
          Logout
        </a>
      </div>
    </div>
  </div>

  <!-- MOBILE Teacher Detail Bottom Sheet -->
  <div id="teacherDetailModal" class="fixed inset-0 z-[9999] sheet-hidden">
    <div id="teacherDetailBackdrop" class="absolute inset-0 bg-slate-900/40 backdrop-blur-sm sheet-backdrop"></div>

    <div class="absolute inset-x-0 bottom-0 max-h-[85vh] rounded-t-3xl bg-white shadow-soft ring-1 ring-black/10 overflow-hidden sheet-panel">
      <div class="px-5 py-4 flex items-start justify-between gap-4 border-b border-slate-100">
        <div class="min-w-0">
          <p class="text-sm font-extrabold text-slate-900">Teacher Details</p>
          <p id="mDetailName" class="mt-1 text-base font-extrabold text-slate-900 truncate">—</p>
          <p id="mDetailEmail" class="mt-1 text-sm font-semibold text-slate-600 break-all">—</p>
        </div>
        <button id="closeTeacherModalBtn" class="h-11 w-11 rounded-xl bg-slate-50 ring-1 ring-black/5 hover:bg-slate-100 inline-flex items-center justify-center active:scale-[.98] transition" aria-label="Close details">
          <svg class="h-6 w-6 text-slate-700" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>

      <div class="p-5 nice-scroll overflow-auto max-h-[calc(85vh-72px)]">
        <div class="flex items-center gap-2 flex-wrap">
          <span id="mDetailPill" class="rounded-full bg-slate-200 px-2 py-0.5 text-[11px] font-extrabold text-slate-700 ring-1 ring-black/5">—</span>
        </div>

        <div class="mt-4 grid gap-2 text-sm font-semibold text-slate-700">
          <p><span class="text-slate-500">Employee ID:</span> <span id="mDetailTeacherId">—</span></p>
          <p><span class="text-slate-500">Department:</span> <span id="mDetailDept">—</span></p>
          <p><span class="text-slate-500">Applied:</span> <span id="mDetailApplied">—</span></p>
        </div>

        <!-- ✅ ADMIN DELETE (always allowed for teachers) -->
        <button id="mDeleteTeacherBtn"
          class="hidden mt-5 w-full inline-flex items-center justify-center rounded-xl bg-rose-600 px-4 py-2.5 text-sm font-extrabold text-white shadow-softer hover:bg-rose-700 focus:outline-none focus:ring-4 focus:ring-rose-200 active:scale-[.98] transition">
          Delete Teacher
        </button>
        <p id="mDeleteHint" class="hidden mt-2 text-xs font-semibold text-slate-500">
          This deletes the teacher document from Firestore.
        </p>

        <span id="mDetailUid" class="hidden"></span>
      </div>
    </div>
  </div>

  <script type="module">
    import { auth, db } from "./firebase.js";
    import { onAuthStateChanged, signOut as firebaseSignOut, setPersistence, browserSessionPersistence } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
    import { collection, query, where, doc, getDoc, onSnapshot, updateDoc, serverTimestamp, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    // Session-only persistence
    try { await setPersistence(auth, browserSessionPersistence); } catch (_) {}

    // =============================
    // Auth gate: ADMIN only
    // =============================
    async function requireAdmin() {
      return await new Promise((resolve) => {
        const unsub = onAuthStateChanged(auth, async (user) => {
          if (!user) {
            window.location.href = "login.html?msg=" + encodeURIComponent("Please log in with an admin account.");
            return;
          }

          let profile = {};
          try {
            const snap = await getDoc(doc(db, "users", user.uid));
            profile = snap.exists() ? (snap.data() || {}) : {};
          } catch (_) {}

          const role = String(profile.role || "student").toLowerCase().trim();
          if (role !== "admin") {
            if (role === "teacher") window.location.href = "teacher-dashboard.html";
            else window.location.href = "index.html";
            return;
          }

          // Header UI
          const name = String(profile.fullName || user.displayName || "Admin").trim() || "Admin";
          const email = String(profile.email || user.email || "").trim();
          const initials = (name.split(/\s+/).filter(Boolean).slice(0,2).map(s => s[0]).join("") || (email[0] || "A")).toUpperCase();
          const __n = document.getElementById("adminName"); if (__n) __n.textContent = name;
          const __a = document.getElementById("adminAvatar"); if (__a) __a.textContent = initials;

          // Logout
          const doLogout = async (e) => {
            e?.preventDefault?.();
            try { await firebaseSignOut(auth); } catch (_) {}
            window.location.href = "login.html";
          };
          document.getElementById("logoutLink")?.addEventListener("click", doLogout);
          document.getElementById("mLogoutLink")?.addEventListener("click", doLogout);

          unsub();
          resolve({ user, profile });
        });
      });
    }

    await requireAdmin();

    // =============================
    // Tabs (desktop + mobile)
    // =============================
    const panels = {
      approvals: document.getElementById("panel-approvals"),
      teachers: document.getElementById("panel-teachers"),
    };

    function setActiveTab(name) {
      for (const [k, el] of Object.entries(panels)) {
        el?.classList.toggle("hidden", k !== name);
      }

      document.querySelectorAll(".tab-btn").forEach((b) => {
        const active = b.getAttribute("data-tab") === name;
        b.classList.toggle("bg-brand-50", active);
        b.classList.toggle("text-brand-800", active);
        b.classList.toggle("ring-1", active);
        b.classList.toggle("ring-black/5", active);
        b.setAttribute("aria-selected", active ? "true" : "false");
      });

      document.querySelectorAll(".m-tab").forEach((b) => {
        const active = b.getAttribute("data-tab") === name;
        b.classList.toggle("bg-brand-50", active);
        b.classList.toggle("text-brand-800", active);
      });

      const activePanel = panels[name];
      if (activePanel) {
        activePanel.classList.remove("panel-anim");
        void activePanel.offsetWidth;
        activePanel.classList.add("panel-anim");
      }
    }

    document.querySelectorAll(".tab-btn").forEach((b) => b.addEventListener("click", () => setActiveTab(b.getAttribute("data-tab"))));
    document.querySelectorAll(".m-tab").forEach((b) => b.addEventListener("click", () => {
      setActiveTab(b.getAttribute("data-tab"));
      closeSidebar();
    }));
    setActiveTab("approvals");

    // Mobile sidebar
    const sidebarOverlay = document.getElementById("sidebarOverlay");
    const openSidebarBtn = document.getElementById("openSidebarBtn");
    const closeSidebarBtn = document.getElementById("closeSidebarBtn");
    const sidebarBackdrop = document.getElementById("sidebarBackdrop");

    function openSidebar() {
      sidebarOverlay?.classList.remove("hidden");
      openSidebarBtn?.setAttribute("aria-expanded", "true");
      document.body.classList.add("overflow-hidden");
    }
    function closeSidebar() {
      sidebarOverlay?.classList.add("hidden");
      openSidebarBtn?.setAttribute("aria-expanded", "false");
      document.body.classList.remove("overflow-hidden");
    }
    openSidebarBtn?.addEventListener("click", openSidebar);
    closeSidebarBtn?.addEventListener("click", closeSidebar);
    sidebarBackdrop?.addEventListener("click", closeSidebar);

    // =============================
    // Toast
    // =============================
    const toast = document.getElementById("toast");
    const toastText = document.getElementById("toastText");
    const toastSub = document.getElementById("toastSub");
    let toastTimer = null;

    function showToast(title, sub) {
      if (!toast) return;
      if (toastText) toastText.textContent = title || "Done";
      if (toastSub) toastSub.textContent = sub || "";
      toast.classList.remove("hidden");
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => toast.classList.add("hidden"), 2500);
    }

    // =============================
    // Detail UI (desktop panel + mobile modal)
    // =============================
    const detailPill = document.getElementById("detailPill");
    const detailEmpty = document.getElementById("detailEmpty");
    const detailBody = document.getElementById("detailBody");
    const detailName = document.getElementById("detailName");
    const detailEmail = document.getElementById("detailEmail");
    const detailTeacherId = document.getElementById("detailTeacherId");
    const detailDept = document.getElementById("detailDept");
    const detailApplied = document.getElementById("detailApplied");
    const detailUid = document.getElementById("detailUid");

    const deleteTeacherBtn = document.getElementById("deleteTeacherBtn");
    const deleteHint = document.getElementById("deleteHint");

    const teacherDetailModal = document.getElementById("teacherDetailModal");
    const teacherDetailBackdrop = document.getElementById("teacherDetailBackdrop");
    const closeTeacherModalBtn = document.getElementById("closeTeacherModalBtn");

    const mDetailPill = document.getElementById("mDetailPill");
    const mDetailName = document.getElementById("mDetailName");
    const mDetailEmail = document.getElementById("mDetailEmail");
    const mDetailTeacherId = document.getElementById("mDetailTeacherId");
    const mDetailDept = document.getElementById("mDetailDept");
    const mDetailApplied = document.getElementById("mDetailApplied");
    const mDetailUid = document.getElementById("mDetailUid");

    const mDeleteTeacherBtn = document.getElementById("mDeleteTeacherBtn");
    const mDeleteHint = document.getElementById("mDeleteHint");

    function openTeacherModal() {
      if (!teacherDetailModal) return;
      teacherDetailModal.classList.remove("sheet-hidden");
      void teacherDetailModal.offsetWidth; // reflow
      teacherDetailModal.classList.add("sheet-open");
      document.body.classList.add("overflow-hidden");
    }

    function closeTeacherModal() {
      if (!teacherDetailModal) return;
      teacherDetailModal.classList.remove("sheet-open");
      setTimeout(() => {
        teacherDetailModal.classList.add("sheet-hidden");
        document.body.classList.remove("overflow-hidden");
      }, 260);
    }

    closeTeacherModalBtn?.addEventListener("click", closeTeacherModal);
    teacherDetailBackdrop?.addEventListener("click", closeTeacherModal);

    function setPillText(el, status) {
      if (!el) return;
      const s = String(status || "").toLowerCase().trim();
      el.textContent = s ? s[0].toUpperCase() + s.slice(1) : "—";
      el.classList.remove("hidden");
    }

    // ✅ Always show delete buttons when a teacher is selected
    function setDeleteVisibility(show) {
      deleteTeacherBtn?.classList.toggle("hidden", !show);
      deleteHint?.classList.toggle("hidden", !show);
      mDeleteTeacherBtn?.classList.toggle("hidden", !show);
      mDeleteHint?.classList.toggle("hidden", !show);
    }

    async function deleteTeacher(uid) {
      const t = allTeachers.find(x => String(x.__id) === String(uid));
      if (!t) return;

      // Extra safety: only delete teacher docs
      if (String(t.role || "").toLowerCase().trim() !== "teacher") {
        alert("This record is not a teacher.");
        return;
      }

      const name = String(t.fullName || "Teacher").trim() || "Teacher";
      const ok = confirm(
        `Delete ${name}?\n\nThis will DELETE the teacher document from Firestore.\nThis action cannot be undone.`
      );
      if (!ok) return;

      try {
        await deleteDoc(doc(db, "users", uid));
        showToast("Deleted", "Teacher has been deleted.");

        // Clear UI
        selectedTeacherId = null;
        detailBody?.classList.add("hidden");
        detailEmpty?.classList.remove("hidden");
        detailPill?.classList.add("hidden");
        setDeleteVisibility(false);

        closeTeacherModal();
      } catch (e) {
        console.error(e);
        alert(e?.message || "Delete failed. Check Firestore rules.");
      }
    }

    deleteTeacherBtn?.addEventListener("click", () => {
      const uid = detailUid?.textContent?.trim();
      if (!uid || uid === "—") return;
      deleteTeacher(uid);
    });

    mDeleteTeacherBtn?.addEventListener("click", () => {
      const uid = mDetailUid?.textContent?.trim();
      if (!uid || uid === "—") return;
      deleteTeacher(uid);
    });

    function tsToText(ts) {
      if (!ts) return "—";
      if (typeof ts === "object" && ts.seconds) {
        const d = new Date(ts.seconds * 1000);
        return d.toLocaleString();
      }
      if (typeof ts === "number") return new Date(ts).toLocaleString();
      return String(ts);
    }

    function norm(s) { return String(s || "").toLowerCase().trim(); }

    function setTeacherDetails(t) {
      if (!t) return;

      const name = String(t.fullName || "Teacher").trim() || "Teacher";
      const email = String(t.email || "").trim();
      const dept = String(t.department || "").trim();
      const tid = String(t.teacherId || "").trim();
      const status = String(t.approvalStatus || (t.approved ? "approved" : "pending")).toLowerCase().trim();
      const appliedAt = tsToText(t.appliedAt || t.createdAt);
      const uid = t.__id || "";

      // Desktop panel
      detailEmpty?.classList.add("hidden");
      detailBody?.classList.remove("hidden");
      setPillText(detailPill, status);

      if (detailName) detailName.textContent = name;
      if (detailEmail) detailEmail.textContent = email || "—";
      if (detailTeacherId) detailTeacherId.textContent = tid || "—";
      if (detailDept) detailDept.textContent = dept || "—";
      if (detailApplied) detailApplied.textContent = appliedAt || "—";
      if (detailUid) detailUid.textContent = uid || "—";

      // Mobile modal
      if (mDetailName) mDetailName.textContent = name;
      if (mDetailEmail) mDetailEmail.textContent = email || "—";
      if (mDetailTeacherId) mDetailTeacherId.textContent = tid || "—";
      if (mDetailDept) mDetailDept.textContent = dept || "—";
      if (mDetailApplied) mDetailApplied.textContent = appliedAt || "—";
      if (mDetailUid) mDetailUid.textContent = uid || "—";

      if (mDetailPill) {
        const s = String(status || "").toLowerCase().trim();
        mDetailPill.textContent = s ? s[0].toUpperCase() + s.slice(1) : "—";
        mDetailPill.className = "rounded-full px-2 py-0.5 text-[11px] font-extrabold ring-1 ring-black/5";
        if (s === "approved") mDetailPill.classList.add("bg-emerald-100","text-emerald-800");
        else if (s === "rejected") mDetailPill.classList.add("bg-rose-100","text-rose-800");
        else mDetailPill.classList.add("bg-amber-100","text-amber-800");
      }

      // ✅ show delete buttons
      setDeleteVisibility(true);
    }

    let selectedTeacherId = null;
    function markSelectedTeacher(uid) {
      selectedTeacherId = uid;
      document.querySelectorAll(".teacher-tap[data-view]").forEach(el => {
        el.classList.toggle("teacher-selected", el.getAttribute("data-view") === uid);
      });
    }

    function openTeacherDetailsById(uid) {
      const t = allTeachers.find(x => String(x.__id) === String(uid));
      if (!t) return;
      markSelectedTeacher(String(uid));
      setTeacherDetails(t);

      if (window.matchMedia("(max-width: 1023px)").matches) {
        openTeacherModal();
      }
    }

    // =============================
    // Data & rendering
    // =============================
    const pendingList = document.getElementById("pendingList");
    const pendingEmpty = document.getElementById("pendingEmpty");
    const teachersList = document.getElementById("teachersList");

    const statPending = document.getElementById("statPending");
    const statApproved = document.getElementById("statApproved");
    const statTotalTeachers = document.getElementById("statTotalTeachers");
    const statSync = document.getElementById("statSync");

    const badgePending = document.getElementById("badgePending");
    const mBadgePending = document.getElementById("mBadgePending");

    const searchPending = document.getElementById("searchPending");
    const searchTeachers = document.getElementById("searchTeachers");
    const refreshBtn = document.getElementById("refreshBtn");

    function teacherCard(t, { showActions }) {
      const name = String(t.fullName || "Teacher").trim() || "Teacher";
      const email = String(t.email || "").trim();
      const dept = String(t.department || "").trim();
      const tid = String(t.teacherId || "").trim();
      const status = String(t.approvalStatus || (t.approved ? "approved" : "pending")).toLowerCase().trim();
      const appliedAt = tsToText(t.appliedAt || t.createdAt);
      const uid = t.__id;

      const pill =
        status === "approved"
          ? `<span class="rounded-full bg-emerald-100 px-2 py-0.5 text-[11px] font-extrabold text-emerald-800 ring-1 ring-black/5">Approved</span>`
          : status === "rejected"
            ? `<span class="rounded-full bg-rose-100 px-2 py-0.5 text-[11px] font-extrabold text-rose-800 ring-1 ring-black/5">Rejected</span>`
            : `<span class="rounded-full bg-amber-100 px-2 py-0.5 text-[11px] font-extrabold text-amber-800 ring-1 ring-black/5">Pending</span>`;

      return `
        <div data-view="${uid}" role="button" tabindex="0"
            class="teacher-tap rounded-2xl bg-slate-50 ring-1 ring-black/5 p-5 cursor-pointer hover:bg-slate-100 hover:-translate-y-[1px] transition focus:outline-none focus:ring-4 focus:ring-brand-200">
          <div class="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3">
            <div class="min-w-0">
              <div class="flex items-center gap-2 flex-wrap">
                <p class="text-sm font-extrabold text-slate-900">${escapeHtml(name)}</p>
                ${pill}
              </div>
              <p class="mt-1 text-sm text-slate-700 break-all">${escapeHtml(email)}</p>
              <div class="mt-3 grid gap-1 text-xs font-semibold text-slate-600">
                <p><span class="text-slate-500">Teacher ID:</span> ${escapeHtml(tid || "—")}</p>
                <p><span class="text-slate-500">Department:</span> ${escapeHtml(dept || "—")}</p>
                <p><span class="text-slate-500">Applied:</span> ${escapeHtml(appliedAt)}</p>
              </div>
            </div>

            ${showActions ? `
              <div class="flex sm:flex-col gap-2 sm:items-end">
                <button data-approve="${uid}"
                  class="inline-flex items-center justify-center rounded-xl bg-emerald-600 px-4 py-2.5 text-sm font-extrabold text-white shadow-softer hover:bg-emerald-700 focus:outline-none focus:ring-4 focus:ring-emerald-200 active:scale-[.98] transition">
                  Approve
                </button>
                <button data-reject="${uid}"
                  class="inline-flex items-center justify-center rounded-xl bg-rose-600 px-4 py-2.5 text-sm font-extrabold text-white shadow-softer hover:bg-rose-700 focus:outline-none focus:ring-4 focus:ring-rose-200 active:scale-[.98] transition">
                  Reject
                </button>
              </div>
            ` : ``}
          </div>
        </div>
      `;
    }

    function escapeHtml(s) {
      return String(s ?? "")
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    let allTeachers = [];

    function applyStagger(container) {
      if (!container) return;
      container.classList.add("stagger");
      Array.from(container.children).forEach((el, i) => {
        el.style.animationDelay = `${Math.min(i * 40, 280)}ms`;
      });
    }

    function applyFiltersAndRender() {
      const qPending = norm(searchPending?.value);
      const qTeachers = norm(searchTeachers?.value);

      const pending = allTeachers.filter(t => !t.approved && norm(t.approvalStatus || "pending") !== "approved");
      const approved = allTeachers.filter(t => t.approved || norm(t.approvalStatus) === "approved");

      if (statPending) statPending.textContent = String(pending.length);
      if (statApproved) statApproved.textContent = String(approved.length);
      if (statTotalTeachers) statTotalTeachers.textContent = String(allTeachers.length);
      if (statSync) statSync.textContent = new Date().toLocaleString();

      const badgeText = String(pending.length);
      if (badgePending) {
        badgePending.textContent = badgeText;
        badgePending.classList.toggle("hidden", pending.length === 0);
      }
      if (mBadgePending) {
        mBadgePending.textContent = badgeText;
        mBadgePending.classList.toggle("hidden", pending.length === 0);
      }

      const pendingFiltered = pending.filter(t => {
        const blob = norm(`${t.fullName || ""} ${t.email || ""} ${t.department || ""} ${t.teacherId || ""}`);
        return !qPending || blob.includes(qPending);
      });

      if (pendingList) pendingList.innerHTML = pendingFiltered.map(t => teacherCard(t, { showActions: true })).join("");
      if (pendingEmpty) pendingEmpty.classList.toggle("hidden", pendingFiltered.length !== 0);

      const allFiltered = allTeachers.filter(t => {
        const blob = norm(`${t.fullName || ""} ${t.email || ""} ${t.department || ""} ${t.teacherId || ""} ${t.approvalStatus || ""}`);
        return !qTeachers || blob.includes(qTeachers);
      });

      if (teachersList) {
        teachersList.innerHTML = allFiltered
          .sort((a,b) => norm(a.fullName).localeCompare(norm(b.fullName)))
          .map(t => teacherCard(t, { showActions: false }))
          .join("");
      }

      if (selectedTeacherId) markSelectedTeacher(selectedTeacherId);

      wireActionButtons();
      wireTeacherTap();

      applyStagger(pendingList);
      applyStagger(teachersList);
    }

    async function approveTeacher(uid) {
      const ref = doc(db, "users", uid);
      await updateDoc(ref, {
        approved: true,
        approvalStatus: "approved",
        approvedAt: serverTimestamp(),
        approvedBy: auth.currentUser?.uid || null
      });
      showToast("Approved", "Teacher account has been approved.");
    }

    async function rejectTeacher(uid) {
      const ref = doc(db, "users", uid);
      await updateDoc(ref, {
        approved: false,
        approvalStatus: "rejected",
        rejectedAt: serverTimestamp(),
        rejectedBy: auth.currentUser?.uid || null
      });
      showToast("Rejected", "Teacher account has been rejected.");
    }

    function wireActionButtons() {
      document.querySelectorAll("[data-approve]").forEach(btn => {
        btn.addEventListener("click", async (e) => {
          e.stopPropagation();
          const uid = btn.getAttribute("data-approve");
          if (!uid) return;
          if (!confirm("Approve this teacher account?")) return;
          try { await approveTeacher(uid); } catch (e) { alert(e?.message || "Approve failed."); }
        });
      });

      document.querySelectorAll("[data-reject]").forEach(btn => {
        btn.addEventListener("click", async (e) => {
          e.stopPropagation();
          const uid = btn.getAttribute("data-reject");
          if (!uid) return;
          if (!confirm("Reject this teacher account?")) return;
          try { await rejectTeacher(uid); } catch (e) { alert(e?.message || "Reject failed."); }
        });
      });
    }

    function wireTeacherTap() {
      document.querySelectorAll(".teacher-tap[data-view]").forEach(card => {
        card.addEventListener("click", (e) => {
          if (e.target.closest("button")) return;
          const uid = card.getAttribute("data-view");
          if (!uid) return;
          openTeacherDetailsById(uid);
        });

        card.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            const uid = card.getAttribute("data-view");
            if (!uid) return;
            openTeacherDetailsById(uid);
          }
        });
      });
    }

    searchPending?.addEventListener("input", applyFiltersAndRender);
    searchTeachers?.addEventListener("input", applyFiltersAndRender);
    refreshBtn?.addEventListener("click", () => applyFiltersAndRender());

    // Listen to teachers collection
    const teachersQ = query(collection(db, "users"), where("role", "==", "teacher"));
    onSnapshot(teachersQ, (snap) => {
      const rows = [];
      snap.forEach(docSnap => {
        const d = docSnap.data() || {};
        rows.push({ ...d, __id: docSnap.id });
      });
      allTeachers = rows;
      applyFiltersAndRender();
    }, (err) => {
      console.error(err);
      alert(err?.message || "Failed to load teachers. Check Firestore rules / indexes.");
    });

  </script>
</body>
</html>
