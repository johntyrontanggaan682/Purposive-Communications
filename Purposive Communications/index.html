<!-- index.html (Welcome Page) -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Purposive Communication | Welcome</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              50: "#E7F7F5",
              100: "#CFF0EC",
              200: "#9FE1D9",
              300: "#6ED2C6",
              400: "#3EC3B3",
              500: "#13A89A",
              600: "#0F877B",
              700: "#0B665C",
              800: "#07453E",
              900: "#032420",
            },
          },
          boxShadow: {
            soft: "0 10px 30px rgba(0,0,0,0.12)",
          },
        },
      },
    };
  </script>

  <style>
    .hero-bg {
      background-image: linear-gradient(to bottom,
          rgba(0, 0, 0, 0.45),
          rgba(0, 0, 0, 0.35)),
        url("https://images.unsplash.com/photo-1521587760476-6c12a4b040da?auto=format&fit=crop&w=1800&q=80");
      background-size: cover;
      background-position: center;
    }
  </style>
</head>

<body class="bg-white text-slate-800">
  <!-- NAVBAR -->
  <header class="fixed inset-x-0 top-0 z-50 bg-white/95 backdrop-blur border-b border-slate-200">
    <nav class="mx-auto flex max-w-7xl items-center justify-between px-4 py-4 sm:px-6 lg:px-8">
      <!-- Brand -->
      <a href="index.html" class="flex items-center gap-3">
        <img src="./assets/logo.png" alt="Purposive Communication Logo"
          class="h-10 w-10 rounded-full ring-1 ring-black/10 object-cover"
          onerror="this.src='https://cdn-icons-png.flaticon.com/512/3135/3135715.png';" />
        <span class="text-lg font-semibold tracking-tight text-slate-900">Purposive Communication</span>
      </a>

      <!-- Desktop Links -->
      <div class="hidden items-center gap-8 md:flex">
        <a href="index.html#home" class="text-sm font-semibold text-brand-700 hover:text-brand-800">Home</a>
        <a href="lessons.html" class="text-sm font-medium text-slate-600 hover:text-brand-700">Lessons</a>
        <a href="profile.html" class="text-sm font-medium text-slate-600 hover:text-brand-700">Profile</a>

        <!-- Login (GUEST ONLY)  ✅ MOVED RIGHT -->
        <a href="login.html" id="openLoginBtn"
          class="auth-guest ml-6 rounded-xl bg-brand-500 px-5 py-2.5 text-sm font-semibold text-white shadow-soft hover:bg-brand-600">
          Login
        </a>

        <!-- User dropdown (LOGGED IN ONLY) ✅ MOVED RIGHT -->
        <div class="auth-user hidden relative ml-6">
          <button id="userMenuBtn" type="button"
            class="inline-flex items-center gap-3 rounded-2xl bg-white px-2 py-1.5 ring-1 ring-black/5 hover:bg-slate-50"
            aria-haspopup="menu" aria-expanded="false">
            <div id="navAvatar"
              class="h-9 w-9 rounded-full bg-slate-100 ring-1 ring-black/5 flex items-center justify-center text-slate-700 font-extrabold">
              U
            </div>
            <span id="navName" class="text-sm font-semibold text-slate-900">Student</span>
            <svg id="navCaret" class="h-4 w-4 text-slate-500 transition-transform" viewBox="0 0 24 24" fill="none"
              stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M6 9l6 6 6-6" />
            </svg>
          </button>

          <!-- Dropdown panel ✅ MOVED RIGHT a bit -->
          <div id="userDropdown"
            class="absolute right-[-10px] mt-3 hidden w-[320px] overflow-hidden rounded-3xl bg-white shadow-soft ring-1 ring-black/10">
            <div class="p-4">
              <div class="flex items-start gap-4">
                <div id="ddAvatar"
                  class="h-12 w-12 rounded-full bg-slate-100 ring-1 ring-black/5 flex items-center justify-center text-slate-700 font-extrabold text-lg">
                </div>
                <div class="min-w-0">
                  <p id="ddName" class="truncate text-base font-extrabold text-slate-900">Student</p>
                  <p class="text-sm font-semibold text-slate-500">Student</p>
                </div>
              </div>

              <div class="mt-4 space-y-3 text-sm">
                <div class="flex items-center gap-3 text-slate-700">
                  <svg class="h-5 w-5 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 4h16v16H4V4z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M22 6l-10 7L2 6" />
                  </svg>
                  <span id="ddEmail" class="truncate">email@example.com</span>
                </div>

                <div class="flex items-center gap-3 text-slate-700">
                  <svg class="h-5 w-5 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="2">
                    <rect x="3" y="5" width="18" height="14" rx="2" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M7 15h4" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M7 9h10" />
                  </svg>
                  <span> ID: <span id="ddId" class="font-semibold text-slate-800">—</span></span>
                </div>
              </div>

              <div class="mt-5 grid grid-cols-2 gap-3">
                <a href="profile.html"
                  class="inline-flex items-center justify-center rounded-2xl bg-brand-800 px-4 py-2.5 text-sm font-semibold text-white hover:bg-brand-900">
                  View profile
                </a>
                <button id="signOutBtn" type="button"
                  class="inline-flex items-center justify-center rounded-2xl bg-slate-100 px-4 py-2.5 text-sm font-semibold text-slate-700 hover:bg-slate-200">
                  Sign out
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Mobile menu button -->
      <button id="menuBtn"
        class="inline-flex items-center justify-center rounded-xl bg-slate-50 p-2 text-slate-800 ring-1 ring-black/5 hover:bg-slate-100 md:hidden"
        aria-label="Open menu" aria-expanded="false">
        <svg id="menuIcon" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </button>
    </nav>

    <!-- Mobile Menu -->
    <div id="mobileMenu" class="mx-auto hidden max-w-7xl px-4 pb-4 sm:px-6 lg:px-8 md:hidden">
      <div class="rounded-2xl bg-white p-4 shadow-soft ring-1 ring-black/5">
        <div class="flex flex-col gap-2">
          <a href="index.html#home" class="rounded-xl px-3 py-2 text-sm font-semibold text-brand-700 bg-brand-50">Home</a>
          <a href="lessons.html" class="rounded-xl px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100">Lessons</a>
          <a href="profile.html" class="rounded-xl px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-100">Profile</a>

          <!-- Login (GUEST ONLY) -->
          <a href="login.html" id="openLoginMobile"
            class="auth-guest mt-2 rounded-xl bg-brand-500 px-4 py-2.5 text-center text-sm font-semibold text-white hover:bg-brand-600">
            Login
          </a>

          <!-- Logged-in block (MOBILE ONLY) -->
          <div class="auth-user hidden mt-2 rounded-2xl bg-white ring-1 ring-black/5 p-3">
            <div class="flex items-center gap-3">
              <div id="mNavAvatar"
                class="h-10 w-10 rounded-full bg-slate-100 ring-1 ring-black/5 flex items-center justify-center font-extrabold text-slate-700">
                U
              </div>
              <div class="min-w-0">
                <p id="mNavName" class="truncate text-sm font-extrabold text-slate-900">Student</p>
                <p id="mNavEmail" class="truncate text-xs font-semibold text-slate-500">email@example.com</p>
              </div>
            </div>
            <div class="mt-3 grid grid-cols-2 gap-2">
              <a href="profile.html"
                class="rounded-xl bg-brand-800 px-3 py-2 text-center text-sm font-semibold text-white hover:bg-brand-900">View profile</a>
              <button id="mSignOutBtn"
                class="rounded-xl bg-slate-100 px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-200">Sign out</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- HERO -->
  <section id="home" class="hero-bg relative min-h-[78vh]">
    <div class="mx-auto flex max-w-7xl flex-col items-center justify-center px-4 pb-24 pt-28 text-center sm:px-6 lg:px-8">
      <h1 class="mt-10 max-w-4xl text-4xl font-extrabold tracking-tight text-white sm:text-5xl lg:text-6xl">
        Master Purposive <br class="hidden sm:block" />
        Communication
      </h1>

      <p class="mt-6 max-w-3xl text-base leading-relaxed text-white/85 sm:text-lg">
        Develop essential communication skills through self-paced learning with interactive lessons, quizzes, and
        real-time
        progress tracking.
      </p>

      <!-- GUEST ONLY -->
      <div id="heroGuestButtons" class="auth-guest mt-10 flex flex-col items-center justify-center gap-4 sm:flex-row">
        <a href="login.html" id="startLearningBtn"
          class="w-full rounded-2xl bg-brand-500 px-8 py-3.5 text-sm font-semibold text-white shadow-soft hover:bg-brand-600 focus:outline-none focus:ring-4 focus:ring-brand-200 sm:w-auto">
          Start Learning
        </a>

        <a href="login.html" id="signUpFreeBtn"
          class="w-full rounded-2xl border border-white/60 bg-white/10 px-8 py-3.5 text-sm font-semibold text-white backdrop-blur hover:bg-white/15 focus:outline-none focus:ring-4 focus:ring-white/20 sm:w-auto">
          Sign Up Free
        </a>
      </div>
    </div>
  </section>

  <!-- WHY CHOOSE -->
  <section class="bg-white py-20">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
      <div class="text-center">
        <h2 class="text-3xl font-extrabold tracking-tight text-slate-900 sm:text-4xl">Why Choose Our Platform?</h2>
        <p class="mx-auto mt-4 max-w-2xl text-slate-600">
          Experience a comprehensive learning journey designed for your success
        </p>
      </div>

      <div class="mt-12 grid gap-8 md:grid-cols-3">
        <div class="rounded-3xl bg-brand-50 p-10 text-center shadow-soft ring-1 ring-black/5">
          <div class="mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-brand-500 text-white">
            <svg viewBox="0 0 24 24" class="h-7 w-7" fill="none" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2" />
              <circle cx="12" cy="7" r="4" />
            </svg>
          </div>
          <h3 class="mt-6 text-xl font-bold text-slate-900">Self-Paced Learning</h3>
          <p class="mt-3 text-sm leading-relaxed text-slate-600">
            Learn at your own pace with flexible scheduling that fits your lifestyle and commitments
          </p>
        </div>

        <div class="rounded-3xl bg-brand-50 p-10 text-center shadow-soft ring-1 ring-black/5">
          <div class="mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-brand-500 text-white">
            <svg viewBox="0 0 24 24" class="h-7 w-7" fill="none" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4 19h16" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M7 16V9" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 16V5" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M17 16v-7" />
            </svg>
          </div>
          <h3 class="mt-6 text-xl font-bold text-slate-900">Progress Tracking</h3>
          <p class="mt-3 text-sm leading-relaxed text-slate-600">
            Monitor your advancement with real-time progress bars and detailed performance analytics
          </p>
        </div>

        <div class="rounded-3xl bg-brand-50 p-10 text-center shadow-soft ring-1 ring-black/5">
          <div class="mx-auto flex h-16 w-16 items-center justify-center rounded-full bg-brand-500 text-white">
            <svg viewBox="0 0 24 24" class="h-7 w-7" fill="none" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M12 11c1.657 0 3-1.343 3-3S13.657 5 12 5 9 6.343 9 8s1.343 3 3 3z" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M7 11v-1a5 5 0 0110 0v1" />
              <path stroke-linecap="round" stroke-linejoin="round" d="M7 11h10v8H7z" />
            </svg>
          </div>
          <h3 class="mt-6 text-xl font-bold text-slate-900">Sequential Learning</h3>
          <p class="mt-3 text-sm leading-relaxed text-slate-600">
            Master each concept before moving forward with our structured unlock system
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- HOW IT WORKS -->
  <section class="bg-white pb-20">
    <div class="mx-auto grid max-w-7xl items-center gap-12 px-4 sm:px-6 lg:grid-cols-2 lg:px-8">
      <div>
        <h2 class="text-3xl font-extrabold tracking-tight text-slate-900 sm:text-4xl">How It Works</h2>

        <div class="mt-10 space-y-8">
          <div class="flex gap-5">
            <div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-full bg-brand-500 text-white font-bold">1</div>
            <div>
              <h3 class="text-lg font-bold text-slate-900">Choose Your Lesson</h3>
              <p class="mt-1 text-sm text-slate-600">Browse through our curated lessons and select the topic you want to master</p>
            </div>
          </div>

          <div class="flex gap-5">
            <div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-full bg-brand-500 text-white font-bold">2</div>
            <div>
              <h3 class="text-lg font-bold text-slate-900">Complete Each Part</h3>
              <p class="mt-1 text-sm text-slate-600">Watch videos, read content, and pass quizzes to unlock the next section</p>
            </div>
          </div>

          <div class="flex gap-5">
            <div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-full bg-brand-500 text-white font-bold">3</div>
            <div>
              <h3 class="text-lg font-bold text-slate-900">Pass Final Assessment</h3>
              <p class="mt-1 text-sm text-slate-600">Demonstrate your mastery by completing the comprehensive final assessment</p>
            </div>
          </div>

          <div class="flex gap-5">
            <div class="flex h-12 w-12 shrink-0 items-center justify-center rounded-full bg-brand-500 text-white font-bold">4</div>
            <div>
              <h3 class="text-lg font-bold text-slate-900">Track Your Progress</h3>
              <p class="mt-1 text-sm text-slate-600">Monitor your achievements and continue building your communication skills</p>
            </div>
          </div>
        </div>
      </div>

      <div class="relative">
        <div class="absolute -inset-6 rounded-[2rem] bg-brand-50 blur-2xl"></div>
        <div class="relative overflow-hidden rounded-[2rem] shadow-soft ring-1 ring-black/5">
          <img src="./assets/how-it-works.jpg" alt="Student learning" class="h-[420px] w-full object-cover sm:h-[520px]"
            onerror="this.src='https://images.unsplash.com/photo-1522202176988-66273c2fd55f?auto=format&fit=crop&w=1400&q=80';" />
        </div>
      </div>
    </div>
  </section>

  <!-- CTA BAND (GUEST ONLY) -->
  <section id="ctaBand" class="auth-guest bg-brand-700 py-20">
    <div class="mx-auto max-w-7xl px-4 text-center sm:px-6 lg:px-8">
      <h2 class="text-3xl font-extrabold tracking-tight text-white sm:text-4xl">Ready to Start Your Learning Journey?</h2>
      <p class="mx-auto mt-4 max-w-2xl text-white/85">
        Join thousands of learners mastering purposive communication skills
      </p>

      <a href="login.html" id="getStartedFreeBtn"
        class="mt-10 inline-flex items-center justify-center rounded-2xl bg-white px-10 py-3.5 text-sm font-semibold text-brand-700 shadow-soft hover:bg-brand-50 focus:outline-none focus:ring-4 focus:ring-white/30">
        Get Started Free
      </a>
    </div>
  </section>

  <!-- FOOTER -->
  <footer class="bg-brand-800 text-white">
    <div class="mx-auto max-w-7xl px-4 py-14 sm:px-6 lg:px-8">
      <div class="grid gap-10 md:grid-cols-3 md:items-start">
        <div>
          <div class="flex items-center gap-3">
            <div class="flex h-11 w-11 items-center justify-center rounded-xl bg-white/10 ring-1 ring-white/20">
              <svg viewBox="0 0 24 24" class="h-6 w-6 text-white" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M4 7l8-4 8 4v10l-8 4-8-4V7z"></path>
                <path d="M8 11l2 2 5-5"></path>
              </svg>
            </div>
            <span class="text-lg font-semibold">Purposive Communication</span>
          </div>
          <p class="mt-4 max-w-sm text-sm leading-relaxed text-white/80">
            Master the art of effective communication through our comprehensive self-paced learning platform. Build
            essential skills for academic and professional success.
          </p>
        </div>

        <div class="md:justify-self-center">
          <h3 class="text-base font-semibold">Quick Links</h3>
          <ul class="mt-4 space-y-3 text-sm text-white/80">
            <li><a class="hover:text-white" href="index.html">Home</a></li>
            <li><a class="hover:text-white" href="lessons.html">About Us</a></li>
            <li><a class="hover:text-white" href="profile.html">Contact</a></li>
          </ul>
        </div>

        <div class="md:justify-self-end">
          <h3 class="text-base font-semibold">Connect</h3>
          <div class="mt-4 flex items-center gap-4">
            <a href="#"
              class="inline-flex h-11 w-11 items-center justify-center rounded-full bg-white/10 ring-1 ring-white/20 hover:bg-white/15"
              aria-label="Facebook">
              <svg viewBox="0 0 24 24" class="h-5 w-5" fill="currentColor" aria-hidden="true">
                <path
                  d="M22 12a10 10 0 10-11.5 9.9v-7H8v-3h2.5V9.8c0-2.5 1.5-3.9 3.8-3.9 1.1 0 2.2.2 2.2.2v2.4H15.5c-1.2 0-1.5.7-1.5 1.5V12H17l-.5 3h-2.5v7A10 10 0 0022 12z" />
              </svg>
            </a>

            <a href="#"
              class="inline-flex h-11 w-11 items-center justify-center rounded-full bg-white/10 ring-1 ring-white/20 hover:bg-white/15"
              aria-label="Twitter">
              <svg viewBox="0 0 24 24" class="h-5 w-5" fill="currentColor" aria-hidden="true">
                <path
                  d="M21 7.2c-.7.3-1.5.5-2.3.6.8-.5 1.4-1.2 1.7-2.1-.8.4-1.6.8-2.5.9A3.9 3.9 0 0015.1 5c-2.1 0-3.8 1.7-3.8 3.8 0 .3 0 .6.1.9-3.2-.2-6-1.7-7.9-4.1-.3.6-.5 1.2-.5 1.9 0 1.3.7 2.5 1.7 3.2-.6 0-1.2-.2-1.7-.5v.1c0 1.9 1.4 3.5 3.2 3.8-.3.1-.7.1-1.1.1-.2 0-.5 0-.7-.1.5 1.7 2.1 2.9 3.9 2.9A7.9 7.9 0 013 18.6 11.2 11.2 0 009 20.3c7.3 0 11.3-6.1 11.3-11.3v-.5c.8-.6 1.4-1.2 1.9-2z" />
              </svg>
            </a>

            <a href="#"
              class="inline-flex h-11 w-11 items-center justify-center rounded-full bg-white/10 ring-1 ring-white/20 hover:bg-white/15"
              aria-label="LinkedIn">
              <svg viewBox="0 0 24 24" class="h-5 w-5" fill="currentColor" aria-hidden="true">
                <path
                  d="M6.9 6.7a2.1 2.1 0 11-4.2 0 2.1 2.1 0 014.2 0zM2.9 21h4V9H2.9v12zM9.4 9h3.8v1.6h.1c.5-.9 1.8-1.9 3.7-1.9 4 0 4.7 2.6 4.7 6V21h-4v-5.4c0-1.3 0-2.9-1.8-2.9s-2.1 1.4-2.1 2.8V21h-4V9z" />
              </svg>
            </a>
          </div>
        </div>
      </div>

      <div class="mt-12 border-t border-white/15 pt-6 text-center text-sm text-white/75">
        © <span id="year"></span> Purposive Communication E-Learning Platform. All rights reserved.
      </div>
    </div>
  </footer>

  <!-- LOGIN MODAL -->
  <div id="loginModal" class="fixed inset-0 z-[60] hidden">
    <div id="loginBackdrop" class="absolute inset-0 bg-black/35 backdrop-blur-sm"></div>

    <div class="relative mx-auto flex min-h-full max-w-3xl items-center justify-center px-4 py-8">
      <div class="relative w-full max-w-lg">
        <button id="closeLoginBtn" type="button"
          class="absolute -top-3 -right-3 z-10 inline-flex h-10 w-10 items-center justify-center rounded-full bg-white text-slate-700 shadow-soft ring-1 ring-black/10 hover:bg-slate-50"
          aria-label="Close login">
          <svg class="h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>

        <iframe id="loginFrame" src="login.html" title="Login"
          class="h-[720px] w-full overflow-hidden rounded-3xl bg-transparent shadow-soft ring-1 ring-black/10"></iframe>
      </div>
    </div>
  </div>

  <script>
    // Footer year
    document.getElementById("year").textContent = new Date().getFullYear();

    // Mobile menu toggle
    const menuBtn = document.getElementById("menuBtn");
    const mobileMenu = document.getElementById("mobileMenu");
    menuBtn?.addEventListener("click", () => {
      const isOpen = !mobileMenu.classList.contains("hidden");
      mobileMenu.classList.toggle("hidden");
      menuBtn.setAttribute("aria-expanded", String(!isOpen));
    });

    // Smooth scroll for # links
    document.querySelectorAll('a[href^="#"]').forEach((a) => {
      a.addEventListener("click", (e) => {
        const href = a.getAttribute("href");
        if (!href || href === "#") return;

        const el = document.querySelector(href);
        if (!el) return;

        e.preventDefault();
        el.scrollIntoView({ behavior: "smooth", block: "start" });

        if (!mobileMenu.classList.contains("hidden")) {
          mobileMenu.classList.add("hidden");
          menuBtn.setAttribute("aria-expanded", "false");
        }
      });
    });

    // ===== Login modal logic =====
    const loginModal = document.getElementById("loginModal");
    const loginBackdrop = document.getElementById("loginBackdrop");
    const openLoginBtn = document.getElementById("openLoginBtn");
    const openLoginMobile = document.getElementById("openLoginMobile");
    const closeLoginBtn = document.getElementById("closeLoginBtn");
    const startLearningBtn = document.getElementById("startLearningBtn");
    const signUpFreeBtn = document.getElementById("signUpFreeBtn");
    const getStartedFreeBtn = document.getElementById("getStartedFreeBtn");

    function openLoginModal(e) {
      e?.preventDefault?.();
      if (isLoggedIn()) return;

      if (mobileMenu && !mobileMenu.classList.contains("hidden")) {
        mobileMenu.classList.add("hidden");
        menuBtn?.setAttribute("aria-expanded", "false");
      }

      loginModal.classList.remove("hidden");
      document.body.classList.add("overflow-hidden");

      startLoginPoll();
    }

    function closeLoginModal() {
      loginModal.classList.add("hidden");
      document.body.classList.remove("overflow-hidden");
      stopLoginPoll();
    }

    openLoginBtn?.addEventListener("click", openLoginModal);
    openLoginMobile?.addEventListener("click", openLoginModal);
    startLearningBtn?.addEventListener("click", openLoginModal);
    signUpFreeBtn?.addEventListener("click", openLoginModal);
    getStartedFreeBtn?.addEventListener("click", openLoginModal);

    closeLoginBtn?.addEventListener("click", closeLoginModal);
    loginBackdrop?.addEventListener("click", closeLoginModal);

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && !loginModal.classList.contains("hidden")) {
        closeLoginModal();
      }
    });

    // ===== Auth state =====
    const LS = {
      session: "pc_session",
      users: "pc_users",
      avatar: "pc_profile_avatar",
      loggedIn: "pc_logged_in"
    };

    const guestEls = Array.from(document.querySelectorAll(".auth-guest"));
    const userEls = Array.from(document.querySelectorAll(".auth-user"));

    const userMenuBtn2 = document.getElementById("userMenuBtn");
    const userDropdown2 = document.getElementById("userDropdown");
    const navCaret = document.getElementById("navCaret");

    const navName = document.getElementById("navName");
    const navAvatar = document.getElementById("navAvatar");

    const ddName = document.getElementById("ddName");
    const ddEmail = document.getElementById("ddEmail");
    const ddId = document.getElementById("ddId");
    const ddAvatar = document.getElementById("ddAvatar");

    const mNavName = document.getElementById("mNavName");
    const mNavEmail = document.getElementById("mNavEmail");
    const mNavAvatar = document.getElementById("mNavAvatar");

    const signOutBtn = document.getElementById("signOutBtn");
    const mSignOutBtn = document.getElementById("mSignOutBtn");

    function safeParseJSON(v, fallback) {
      try { return JSON.parse(v); } catch { return fallback; }
    }

    function getSession() {
      const raw = localStorage.getItem(LS.session);
      return raw ? safeParseJSON(raw, null) : null;
    }

    function getUsers() {
      const raw = localStorage.getItem(LS.users);
      return raw ? safeParseJSON(raw, []) : [];
    }

    function isLoggedIn() {
      const s = getSession();
      return !!(s && s.email);
    }

    function getInitials(name) {
      const n = (name || "").trim();
      if (!n) return "U";
      const parts = n.split(/\s+/).filter(Boolean);
      const first = parts[0]?.[0] || "U";
      const last = parts.length > 1 ? parts[parts.length - 1][0] : "";
      return (first + last).toUpperCase();
    }

    function getAvatarDisplay(userName) {
      const raw = localStorage.getItem(LS.avatar);
      const obj = raw ? safeParseJSON(raw, null) : null;
      if (obj && obj.type === "emoji" && obj.value) return { type: "emoji", value: obj.value };
      return { type: "initials", value: getInitials(userName) };
    }

    function setAvatarEl(el, avatar) {
      if (!el) return;
      el.textContent = avatar.value;
    }

    function closeUserDropdown() {
      if (!userDropdown2 || !userMenuBtn2) return;
      userDropdown2.classList.add("hidden");
      userMenuBtn2.setAttribute("aria-expanded", "false");
      navCaret?.classList.remove("rotate-180");
    }

    function openUserDropdown() {
      if (!userDropdown2 || !userMenuBtn2) return;
      userDropdown2.classList.remove("hidden");
      userMenuBtn2.setAttribute("aria-expanded", "true");
      navCaret?.classList.add("rotate-180");
    }

    function toggleUserDropdown() {
      if (!userDropdown2) return;
      const isOpen = !userDropdown2.classList.contains("hidden");
      if (isOpen) closeUserDropdown();
      else openUserDropdown();
    }

    userMenuBtn2?.addEventListener("click", (e) => {
      e.preventDefault();
      toggleUserDropdown();
    });

    document.addEventListener("click", (e) => {
      if (!userDropdown2 || userDropdown2.classList.contains("hidden")) return;
      const wrapper = userMenuBtn2?.parentElement;
      if (wrapper && e.target instanceof Node && !wrapper.contains(e.target)) closeUserDropdown();
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") closeUserDropdown();
    });

    function applyAuthUI() {
      const loggedIn = isLoggedIn();
      localStorage.setItem(LS.loggedIn, loggedIn ? "true" : "false");

      guestEls.forEach(el => el.classList.toggle("hidden", loggedIn));
      userEls.forEach(el => el.classList.toggle("hidden", !loggedIn));

      if (!loggedIn) {
        closeUserDropdown();
        return;
      }

      const session = getSession();
      const email = (session?.email || "").toLowerCase();
      const users = getUsers();
      const found = users.find(u => (u.email || "").toLowerCase() === email) || null;

      const fullName = (session?.fullName || found?.fullName || "Student").trim();
      const studentId = (found?.studentId || "—").trim() || "—";
      const avatar = getAvatarDisplay(fullName);

      if (navName) navName.textContent = fullName;
      if (ddName) ddName.textContent = fullName;
      if (ddEmail) ddEmail.textContent = session?.email || found?.email || "";
      if (ddId) ddId.textContent = studentId;

      setAvatarEl(navAvatar, avatar);
      setAvatarEl(ddAvatar, avatar);

      if (mNavName) mNavName.textContent = fullName;
      if (mNavEmail) mNavEmail.textContent = session?.email || found?.email || "";
      setAvatarEl(mNavAvatar, avatar);
    }

    function signOut() {
      localStorage.removeItem(LS.session);
      localStorage.setItem(LS.loggedIn, "false");
      closeUserDropdown();
      applyAuthUI();
      closeLoginModal();
    }

    signOutBtn?.addEventListener("click", signOut);
    mSignOutBtn?.addEventListener("click", signOut);

    window.addEventListener("storage", (e) => {
      if (e.key === LS.session || e.key === LS.avatar) {
        applyAuthUI();
        if (isLoggedIn() && !loginModal.classList.contains("hidden")) closeLoginModal();
      }
    });

    let __loginPoll = null;
    function startLoginPoll() {
      stopLoginPoll();
      __loginPoll = setInterval(() => {
        applyAuthUI();
        if (isLoggedIn() && !loginModal.classList.contains("hidden")) closeLoginModal();
      }, 400);
    }
    function stopLoginPoll() {
      if (__loginPoll) clearInterval(__loginPoll);
      __loginPoll = null;
    }

    applyAuthUI();
    window.addEventListener("focus", applyAuthUI);

    // ✅ NEW: If user clicks Lessons/Profile while NOT logged in, open login modal.
    // (When logged in, it navigates normally.)
    document.querySelectorAll('a[href="lessons.html"], a[href="profile.html"]').forEach((a) => {
      a.addEventListener("click", (e) => {
        if (!isLoggedIn()) {
          openLoginModal(e);
        }
      });
    });
  </script>
</body>

</html>
